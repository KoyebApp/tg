const fetch = require('node-fetch');

let handler = async ({ m, bot, query, command }) => {
  const suggest = "Type the command along with the prompt ğŸ¥º";

  if (!query) {
    await bot.sendMessage(m.chat.id, suggest);
    return;
  }

  try {
    const res = await (await fetch('https://lexica.art/api/v1/search?q=' + query)).json();
    const randm = res.images;
    const resul = randm[Math.floor(Math.random() * randm.length)]; // Pick a random image from the array

    // Wait message to indicate the bot is processing the request
    await bot.sendMessage(m.chat.id, "â³ Please wait, generating image...");

    const maker = "Generated by Lexica"; // Add this line before using 'maker'

    // Send the generated image to the user
    await bot.sendPhoto(m.chat.id, resul.src, {
      caption: `${maker}\nCreative: ${resul.prompt}\n\n[ğ™¿ğ™¾ğš†ğ™´ğšğ™´ğ™³ ğ™±ğšˆ Â© ğ™¼ğ™´ğ™¶ğ™°-ğ™°ğ™¸]`
    });

  } catch (error) {
    console.error('Error generating image:', error);
    await bot.sendMessage(m.chat.id, "âŒ An error occurred while generating the image. Please try again later.");
  }
};

module.exports = handler;
